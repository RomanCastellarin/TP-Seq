\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[spanish]{babel}
\usepackage[pdftex]{graphicx}
\usepackage{float}
\usepackage{booktabs}
\usepackage[table,xcdraw]{xcolor}
\usepackage{ltxtable}
\usepackage{listings}
\lstset{language=Haskell}
\usepackage{color}
\begin{document}
\begin{titlepage}

\begin{minipage}{2.6cm}
\includegraphics[width=\textwidth]{fceia.pdf}
\end{minipage}
\hfill
%
\begin{minipage}{6cm}
\begin{center}
\normalsize{Universidad Nacional de Rosario\\
Facultad de Ciencias Exactas,\\
Ingeniería y Agrimensura\\}
\end{center}
\end{minipage}
\hspace{0.5cm}
\hfill
\begin{minipage}{2.6cm}
\includegraphics[width=\textwidth]{unr.pdf}
\end{minipage}

\vspace{0.5cm}

\begin{center}
\normalsize{\sc Estructuras de Datos II}\\
\vspace{0.5cm}
\large{Trabajo Práctico II}\\

\Large{\bf Secuencias}\\
\vspace{5cm}

\normalsize
Román Castellarin\\
Juan Ignacio Suarez\\

\vspace*{0.5cm}
\small{ \today }


\end{center}
\end{titlepage}
\newpage

\section{Implementacion basada en Arrays Persistentes}

\begin{tabular}{@{}lcc@{}}
\toprule
        & W & S \\ \midrule
filterS p x & $O(|x| + \sum\limits_{i=0}^{|x|-1} W[p\ x_i])$  &  $(\log |x| + \max\limits_{i=0}^{|x|-1} S[p\ x_i])$  \\
reduceS f e s & $O(N)$  &  $O(N)$ \\
scanS   & $O(N)$  &  $O(N)$ \\
showtS  & $O(N)$  &  $O(N)$ \\ \bottomrule
\end{tabular}

\subsection{filterA es $O(|x| + \sum\limits_{i=0}^{|x|-1} W[p\ x_i])$ en trabajo, y $O(\log |x| + \max\limits_{i=0}^{|x|-1} S[p\ x_i])$ prof.}

\begin{table}[h]
\begin{lstlisting}
filterA p x = A.flatten (mapA g x)
    where g y = if p y then singletonA y else emptyA
\end{lstlisting}
\caption{Definicion de filterA}
\end{table}
\begin{itemize}
\item \textbf{Lema:} \texttt{singletonA} y \texttt{emptyA} son $O(1)$ en trabajo y profundidad.

 \textit{Dem:} Ambas hacen una cantidad constante de operaciones independientemente de la entrada.
 
\item \textbf{Lema:} \texttt{mapA f s} es $O( \sum\limits_{i=0}^{|s|-1} W[f\ s_i] )$ en trabajo y $O( \max\limits_{i=0}^{|s|-1} S[f\ s_i] )$ en profundidad.

 \textit{Dem:} Se desprende como corolario de las cotas de \texttt{tabulate g n} con $g\ i = f\ s_i$ y $n=|s|$. 
 
\end{itemize}

Del primer lema, resulta que en la definicion de \texttt{map} presentada arriba,  $W[g\ y]\in O(W[p\ y])$ y $S[g\ y]\in O(S[p\ y])$.

Del segundo lema anterior, resulta \texttt{map\ g\ x} es $O(\sum\limits_{i=0}^{|x|-1} W[p\ x_i])$ en trabajo y $O(\max\limits_{i=0}^{|x|-1} S[p\ x_i])$ en profundidad.

Es necesario calcular primero \texttt{map\ g\ x} para luego aplicar el \texttt{flatten}, por lo que la profundidad (ademas del trabajo) se suman ya que no se realizan en paralelo.

Tenemos entonces por la especificacion dada de \texttt{flatten} que \texttt{filter\ p\ x} es $O(|x| + \sum\limits_{i=0}^{|x|-1} W[p\ x_i])$ en trabajo ya que $|g(y)| \in O(1)$, mientras que en profundidad es $O(\log |x| + \max\limits_{i=0}^{|x|-1} S[p\ x_i])$.


\subsection{reduceA es $O(|s| + \sum\limits_{(x\oplus y)\in\mathcal{O}_r(\oplus,e,s)} W[x\oplus y])$ en trabajo.}

Utilizaremos $\mathcal{O}_r(\oplus,e,s)$ para denotar el conjunto de aplicaciones de $\oplus$ al invocar \texttt{reduceA $\oplus$ e s}. Notemos que para reducir una secuencia de largo $n$ por aplicacion repetida de $\oplus$ (en cualquier orden) hacen falta $n-1$ aplicaciones, por lo que cardinalidad de este conjunto es $O(|s|)$.

Para el analisis general de costo, supondremos primero que $W[x \oplus y]$ es $O(1)$, y luego deduciremos el caso general.

\begin{itemize}
\item \textbf{Lema:} Para $W_\oplus,S_\oplus \in O(1)$, \texttt{contractA $\oplus$ s} es $O(|s|)$ en trabajo y $O(1)$ en profundidad.

 \textit{Dem:} Corolario de las cotas de \texttt{tabulate g n} con $g\ i = s_{2i}\oplus s_{2i+1}$ y $n\in O(|s|)$.
\end{itemize}

Veamos que como \texttt{contract} reduce la longitud de la secuencia en un factor de $1/2$, \texttt{reduceByContraction} solo recursa $O(\log |s|)$ veces, y por lo tanto (bajo la hip. de $S_\oplus \in O(1)$) resulta $O(\log |s|)$ en profundidad.

Para el trabajo, veamos que obtenemos una serie geometrica, por lo que (bajo la hip. de $W_\oplus \in O(|s|)$) resulta $O(|s|)$.

Para una especificacion de costos general, notemos que solo debemos agregarle al trabajo obtenido, el trabajo de cada operacion ($x\oplus y$) hecho, y la profundidad no puede empeorar mas que en un factor $\max\limits_{(x\oplus y)\in\mathcal{O}_r(\oplus,e,s)} S[x\oplus y]$.

Por lo que finalmente obtenemos:
$$O(|s| + \sum\limits_{(x\oplus y)\in\mathcal{O}_r(\oplus,e,s)} W[x\oplus y])$$ en trabajo,y

$$ O(\log |s|\cdot \max\limits_{(x\oplus y)\in\mathcal{O}_r(\oplus,e,s)} S[x\oplus y])$$ en profundidad.


\section{Implementacion basada en Listas}

\begin{tabular}{@{}lcc@{}}
\toprule
        & W & S \\ 
\midrule
filterS f s & $O(|s| + \sum\limits_{i=0}^{|s|-1} W[f\ s_i])$  & $O(|s| + \sum\limits_{i=0}^{|s|-1} W[f\ s_i])$  \\
showtS  & $O()$  &  $O()$ \\
reduceS f e s & $O(|s| + \sum\limits_{i=0}^{|s|/2} W[f\ s_{2i}\ s_{2i+1}])$  &  $O()$ \\
scanS   & $O()$  &  $O()$ \\ 
\bottomrule
\end{tabular}


\subsection{filterL es $O(|s| + \sum\limits_{i=0}^{|s|-1} W[f\ s_i])$ en trabajo, y $O(|s| + \sum\limits_{i=0}^{|s|-1} W[f\ s_i])$ prof.}

\begin{table}[h]
\begin{lstlisting}
filterL f []     = []
filterL f (x:xs) = let (x',xs') = (if f x then [x] else []) ||| (filterL f xs) in x'++xs'
\end{lstlisting}
\caption{Definicion de filterL}
\end{table}
\begin{itemize}

\item \textbf{Trabajo de filterL:}

Teniendo como segundo argumento el largo de la secuencia $s$: \\
\\
    $W_{filter}(f, 0) = c_0$ \\
    $W_{filter}(f, n) = 1 + ( 1 + W($if $f\ s_0$ then $[x]$ else $[]) + W_{filter}(f, n-1) ) + W(x'++xs') = $ \\
\\
    Como el costo de 'if' es constante (además de construir el resultado), vemos rápidamente que el costo de esta primer expresión es $W(f\ s_0) + k$.
    Además, siendo $x'$ la asignación de este resultado, vemos que $x'++xs'$ también será de costo constante pues $x'$ será $[]$ ó $[x]$ y la función $++$ depende del tamaño del primer argumento. Siguiendo:\\
\\
    $ = c_1 + W(f\ s_0) + W_{filter}(f, n-1) = ... = \sum\limits_{i=0}^{n-1} c_i + \sum\limits_{i=0}^{n-1} W[f\ s_i] $ \\
\\
    Donde se desprende $\sum\limits_{i=0}^{n-1} c_i$ de orden lineal más la sumatoria de costos de $f$ en los valores de la secuencia. Es decir: \\
\\
    $W_{filter} \in O(n + \sum\limits_{i=0}^{n-1} W[f\ s_i] ) = O(|s| + \sum\limits_{i=0}^{|s|-1} W[f\ s_i])$\\

\item \textbf{Profundidad de filterL:}

Similar a como analizamos el trabajo, tenemos: \\
\\
    $S_{filter}(f, 0) = c_0$ \\
    $S_{filter}(f, n) = 1 + ( 1 + max\{ S($if $f\ s_0$ then $[x]$ else $[]), S_{filter}(f, n-1)\} ) + S(x'++xs') = $ \\
\\
    Así como sucedía con el costo también sucede con la profundidad, en el caso del 'if' también tenemos $S(f\ s_0) + k$ y la profundidad de $++$ seguirá siendo constante. Siguiendo:\\
\\
    $ = c_1 + max\{ S(f\ s_0), S_{filter}(f, n-1) \} = c_1 + max\{ S(f\ s_0), c_2 + max\{S(f\ s_1), S_{filter}(f, n-2) \} \} \ (1) $ \\
\\
    Sea $S_f$ tal que $S_f = \max\limits_{0<=i<n} S(f\ s_i)$. \\
    Volviendo a $(1)$, reemplazando con $S_f$ nos queda:\\
\\
    $(1) \leq 
    c_1 + max\{ S_f, c_2 + max\{S_f, S_{filter}(f, n-2) \} \} \leq 
    c_1 + max\{ S_f, c_2 + max\{S_f, ... max\{ S_f, c_0 \} ... \} \} = $\\
\\
    Si consideramos $c_0 \leq S_f$ esto resulta en:\\
\\
    $ = \sum\limits_{i=0}^{n-1} c_i + S_f $\\
\\
    Nuevamente se desprende de la primer sumatoria un orden lineal sumado a $S_f$, el cual por definición era el máximo $S(f\ s_i)$. Por lo tanto: \\
\\
    $S_{filter} \in O(n + \max\limits_{i} S[f\ s_i] )$\\


\end{itemize}

\end{document}